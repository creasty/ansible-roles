- name: node | install nvm
  git:
    repo:    https://github.com/creationix/nvm.git
    dest:    '/usr/local/nvm-repo'
    version: v0.17.3

- name: node | create directory
  file:
    path:  '/usr/local/{{ item }}'
    state: directory
    owner: root
    group: wheel
    mode:  0775
  with_items:
    - nvm
    - node

- name: node | copy nvm initialize script
  copy:
    src:   '{{ common_path }}/files/nodejs/nvm.sh'
    dest:  /etc/profile.d/nvm.sh
    owner: root
    group: root
    mode:  0755

- name: node | install node
  command: 'nvm install {{ nodejs.version }}'

- name: node | set default version
  command: >
    nvm alias default {{ nodejs.version }}
    nvm use {{ nodejs.version }}
