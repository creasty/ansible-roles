- name: create an user
  user:
    name:  '{{ user.name }}'
    home:  '{{ user.path }}'
    shell: /bin/bash

- name: setup authorized_key
  authorized_key:
    user: '{{ user.name }}'
    key:  '{{ lookup("file", user.login_pubkey_file) }}'

- name: copy id_rsa
  copy:
    src:  '{{ user.id_rsa_file }}'
    dest: '{{ user.path }}/.ssh/id_rsa'
    mode: '0600'

- name: copy the user's sudoers
  template:
    src:   '{{ common_path }}/templates/user/sudoer'
    dest:  '/etc/sudoers.d/{{ user.name }}'
    owner: root
    group: root
    mode:  0440

