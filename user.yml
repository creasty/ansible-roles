- name: user | create an user
  user:
    name:  '{{ user.name }}'
    home:  '{{ user.path }}'
    shell: /bin/bash

- name: user | setup authorized_key
  authorized_key:
    user: '{{ user.name }}'
    key:  '{{ item }}'
  with_file:
    - '{{ loop_assets_path }}/files/user/{{ user.authorized_key }}.pub'

- name: user | copy id_rsa
  copy:
    src:  '{{ assets_path }}/files/user/{{ user.id_rsa }}'
    dest: '{{ user.path }}/.ssh/id_rsa'
    mode: 0600

- name: user | copy the user's sudoers
  template:
    src:   user/sudoer
    dest:  '/etc/sudoers.d/{{ user.name }}'
    owner: root
    group: root
    mode:  0440

